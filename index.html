<html>

<head>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const TOTAL_SENTENCE = 6236;
        const QURAN_ENDPOINT = "https://api.alquran.cloud/v1/ayah"

        var words = [];
        var prevWords = [];
        var currentWord = "";

        function setWord() {
            if (words.length === 0) {
                return getSentence(setWord)
            }

            var word = "";
            while (word === "" && words.length > 0) {
                word = words.pop()
                if (currentWord === word) {
                    prevWords.push(word);
                    word = ""
                }
            }

            if (words.length === 0) {
                return getSentence(setWord)
            }

            currentWord = word;
            prevWords.push(word);
            $("#word").html(word);
            $("#body").css("font-size", window.innerHeight / 3);
        }

        function prevWord() {
            if (prevWords.length === 0) {
                return;
            }

            var word = "";
            while (word === "" && prevWords.length > 0) {
                word = prevWords.pop()
                if (currentWord === word) {
                    words.push(word);
                    word = ""
                }
            }

            if (word) {
                currentWord = word;
                words.push(word);
                $("#word").html(word);
                $("#body").css("font-size", window.innerHeight / 3);
            }
        }

        function getSentence(cb) {
            var num = Math.floor(Math.random() * TOTAL_SENTENCE)
            $.getJSON(QURAN_ENDPOINT + "/" + num + "/quran-uthmani", function (data) {
                if (!data || !data.data || !data.data.text) {
                    console.log(JSON.stringify(data));
                    throw "invalid data"
                }

                w = data.data.text.split(" ");

                w.forEach((word) => {
                    word = word.replace(" ۖ", "");
                    word = word.replace(" ۚ", "");
                    word = word.replace(" ۗ", "");
                    word = word.replace("۞", "");
                    word = word.replace("۞", "");
                    word = word.replace("", "");

                    if (word === "ٱللَّهَ") word = "";
                    if (word === "ٱللَّهِ") word = "";

                    words.push(word);
                })
                shuffleArray(words);
                return cb()
            });
        }

        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
        }

        $(document).ready(function () {
            getSentence(function () {
                setWord();
            });

            $("#next").click(setWord)
            $("#prev").click(prevWord)
        })

    </script>

    <style>
        body {
            margin: 0;
            padding: 0;
            text-align: center;
        }

        #word {
            width: 100%;
            position: fixed;
            top: 10%;
        }

        #buttons {
            position: fixed;
            bottom: 2%;
            width: 100%;
        }

        button {
            width: 40%;
            height: 10%;
            border: none;
            color: white;
            padding: 1%;
            border-radius: 20px;
            text-align: center;
            display: inline-block;
            cursor:pointer;
            font-size: 10%;
        }

        #next {
            background-color: #4CAF50; /* Green */
        }

        #prev {
            background-color: #008CBA; /* Blue */
        }

        #border {
            width: 5%;
        }
    </style>
</head>

<body id="body">
    <div id="word"></div>
    <div id="buttons">
        <button id="prev">&lt;&lt;</button><span id="border">&nbsp;</span><button id="next">&gt;&gt;</button>
    </div>
</body>

</html>
